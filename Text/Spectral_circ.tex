\documentclass[a4paper]{article}   	% use "amsart" instead of "article" for AMSLaTeX format

\usepackage{geometry}                	
\geometry{a4paper,margin=1.1in}           % ... or a4paper or a5paper or ... 

%\usepackage{graphicx}			

\usepackage{amsmath}

\usepackage{hyperref}
\hypersetup{colorlinks=true,
    citecolor=blue,    filecolor=blue,
    linkcolor=blue,     urlcolor=blue
}
%\usepackage[pdftex]{tulhypref}

\newcommand{\ir}{\frac{1}{r}}
\newcommand{\Integ}[1]{\int_{-\infty}^{\infty} \!\!\!\!\!
  \mathrm{d}#1}
\newcommand{\RInteg}[1]{\int_{0}^{\infty} \!\!\!\!\! #1\mathrm{d}#1}
\newcommand{\TInteg}[1]{\int_{0}^{2\pi} \!\!\!\!\! \mathrm{d}#1}


% Reference automatique aux equations, sections, figures
\usepackage{cleveref}

\title{A spectral, cylindrical, dispersion-free Particle-In-Cell algorithm}
\date{}
%\pagestyle{empty}
\author{R\'emi \textsc{Lehe}}


\begin{document}

\maketitle


\section*{Introduction}

\paragraph{Importance of PIC codes } Used in many fields : astro, laser-plasma interaction. However, 3D codes are expensive, and their limited resolution leads to many numerical effects (Cherenkov, dispersion).

\paragraph{Cylindrical PIC codes} A range of physical situations have close-to cylindrical symmetry (e.g. electron beam propagation, laser-wakefield acceleration), and they can be simulated with very significant speedup using a cylindrically symmetric algorithm (Lischitz, Davidson). This typically reduces the cost of the simulation to a few times that of a 2D simulation, instead of that of a full 3D simulation.

\paragraph{Spectral PIC codes} In parallel, 3D spectral PIC codes have been developped, and can mitigate numerical instability (articles Warren and Brendan Godfrey). In spectral space, some algorithms have no numerical dispersion whatsoever (article PSATD). This is important in laser-wakefield acceleration since even a very small amount of numerical dispersion can introduce spurious injection. Typically, this imposes to strongly overresolve the wavelength of the laser (thereby increasing computational requirements), and to use very asymetric cell aspect ratio. Although the spectral algorithms reduce the requirements on the longitudinal resolution, they still require a 3D grid, and therefore a large computational load.

\paragraph{Spectral, cylindrical PIC codes } In this document, we combine the two approaches. Advantages:
\begin{itemize}
\item Significant speedup due to the cylindrical geometry.
\item Ideal dispersion relation in PSATD, independent on azimuthal mode (with a finite difference algorithm, the different modes go at different speeds)
\item Fields are colocated in space and time in PSATD and not staggered, which simplifies interpolation, and prevents time-interpolation errors in compensation of E and B (article plasma lens)
\item Ability to apply filters in k space and thereby limit numerical instabilities
\item Prevent on-axis noise that appear in finite-difference cylindrical algorithms.
\end{itemize}


\section{Representation of the fields and continuous equations}

\subsection{Reminder on Cartesian spectral codes}

It is well-known that the Maxwell equations in Cartesian coordinates 
\begin{align}
\partial_t E_x = \partial_y B_z - \partial_z B_y - \mu_0  j_x \qquad&   
\partial_t B_x = -\partial_y E_z + \partial_z E_y \label{eq:CartMaxwellx} \\
\partial_t E_y = \partial_z B_x - \partial_x B_z - \mu_0  j_y \qquad &   
\partial_t B_y = -\partial_z E_x + \partial_x E_z \label{eq:CartMaxwelly}  \\
\partial_t E_z = \partial_x B_y - \partial_y B_x - \mu_0  j_z \qquad &   
\partial_t B_z = -\partial_x E_y + \partial_y E_x \label{eq:CartMaxwellz} 
\end{align}
can be solved by representing the fields as a sum of Fourier modes.
\begin{equation}
\label{eq:CartBwTrans}
F_u(\vec{r}) = \frac{1}{(2\pi)^{3/2}}\Integ{k_x} \,\Integ{k_y}\, \Integ{k_z} \; \hat{F}_u(\vec{k}) e^{i(k_x x + k_y y + k_z z)} 
\end{equation}
with 
\begin{equation}
\label{eq:CartFwTrans}
\hat{F}_u(\vec{k})  = \frac{1}{(2\pi)^{3/2}}\Integ{x} \,\Integ{y}\, \Integ{z} \; F_u(\vec{r}) e^{-i(k_x x + k_y y + k_z z)} 
\end{equation}
where $F$ is any of the fields $E$, $B$ or $j$, and where $u$ is
either $x$, $y$ or $z$. In this case, the different Fourier modes decouple and the equations \cref{eq:CartMaxwellx,eq:CartMaxwelly,eq:CartMaxwellz} become 
\begin{align}
\partial_t \hat{E}_x = ik_y \hat{B}_z - ik_z \hat{B}_y - \mu_0 \hat{j}_x \qquad &   
\partial_t \hat{B}_x = -ik_y \hat{E}_z + ik_z \hat{E}_y \\
\partial_t \hat{E}_y = ik_z \hat{B}_x - ik_x \hat{B}_z - \mu_0  \hat{j}_y \qquad &   
\partial_t \hat{B}_y = -ik_z \hat{E}_x + ik_x \hat{E}_z \\
\partial_t \hat{E}_z = ik_x \hat{B}_y - ik_y \hat{B}_x - \mu_0 \hat{j}_z  \qquad &   
\partial_t \hat{B}_z = -ik_x \hat{E}_y + ik_y \hat{E}_x 
\end{align}
The Fourier coefficients can then be integrated in time, and
transformed back into real space using \cref{eq:CartBwTrans}. This is
the core principle of Cartesian pseudo-spectral codes.

\subsection{Cylindrical spectral decomposition}

The Fourier representation \cref{eq:CartBwTrans} is no longer the
appropriate representation when the Maxwell equations are written in cylindrical coordinates.
\begin{align}
\partial_t E_r = \ir \partial_\theta B_z - \partial_z B_\theta - \mu_0  j_r \qquad&   
\partial_t B_r = -\ir \partial_\theta E_z + \partial_z E_\theta \label{eq:CircMaxwellr} \\
\partial_t E_\theta = \partial_z B_r - \partial_r B_z - \mu_0  j_\theta \qquad &   
\partial_t B_\theta = -\partial_z E_r + \partial_r E_z \label{eq:CircMaxwellt}  \\
\partial_t E_z = \ir\partial_r r B_\theta - \ir\partial_\theta B_r - \mu_0  j_z \qquad &   
\partial_t B_z = -\ir\partial_r r E_\theta + \ir\partial_\theta E_r \label{eq:CircMaxwellz} 
\end{align}
In this case, the Fourier modes do not decouple, when injecting
\cref{eq:CartBwTrans} into the \cref{eq:CircMaxwellr,eq:CircMaxwellt,eq:CircMaxwellz}. Instead one has to use the Fourier-Bessel representation.
\begin{align}
& F_u(\vec{r}) = \sum_{m=-\infty}^{\infty} \Integ{k_z}
\RInteg{k}\; \tilde{F}_{u,m}(k_z,k) \; J_m(kr)\, e^{-im\theta + ik_z z} 
\label{eq:CircBwTransu} \\
& F_r(\vec{r}) = \sum_{m=-\infty}^{\infty} \Integ{k_z}\,\RInteg{k}\;
\left( \tilde{F}_{+,m}(k_z,k)\; J_{m+1}(kr) +\tilde{F}_{-,m}(k_z,k)\; J_{m-1}(kr)
\right)  e^{-im\theta +ik_z z}
\label{eq:CircBwTransr} \\
& F_\theta(\vec{r}) = \sum_{m=-\infty}^{\infty} \Integ{k_z}\,\RInteg{k}\;
i\left( \tilde{F}_{+,m}(k_z,k)\; J_{m+1}(kr) - \tilde{F}_{-,m}(k_z,k)\; J_{m-1}(kr)
\right)  e^{-im\theta +ik_z z} 
\label{eq:CircBwTranst}
\end{align}
where $F$ is either $E$, $B$ or $j$ and $u$ is either $x$, $y$ or $z$,
and where
\begin{align}
\tilde{F}_{u,m}(k_z,k) = \frac{1}{(2\pi)^2} \Integ{z} \RInteg{r}
\TInteg{\theta} \;F_u(\vec{r})\; J_m(kr) e^{-im\theta
 - i k_z z} \label{eq:CircFwTransu} \\
\tilde{F}_{+,m} = \frac{\tilde{F}_{x,m+1} -
    i\tilde{F}_{y,m+1}}{2} \qquad \tilde{F}_{-,m} = \frac{\tilde{F}_{x,m-1} +
    i\tilde{F}_{y,m-1}}{2}
\label{eq:CircFwTranspm} 
\end{align}
\noindent (See \cref{sec:CircTrans} for a derivation of this representation and
 for its relation to the Fourier transform.)

When injecting \cref{eq:CircBwTransr,eq:CircBwTranst,eq:CircBwTransu}
(for $u=z$) into the Maxwell equations in cylindrical
coordinates \label{eq:CircMaxwellr,eq:CircMaxwellt,eq:CircMaxwellz},
the different modes decouple, and the equations for the spectral
coefficients become:
\begin{align}
\partial_t \tilde{E}_{+,m} = - \frac{ik}{2}\tilde{B}_{z,m} + k_z\tilde{B}_{+,m} - \mu_0\tilde{j}_{+,m} \qquad &   
\partial_t \tilde{B}_{+,m} = \frac{ik}{2} \tilde{E}_{z,m} - k_z \tilde{E}_{+,m} \\
\partial_t \tilde{E}_{-,m} = -\frac{ik}{2} \tilde{B}_{z,m} - k_z \tilde{B}_{-,m} - \mu_0  \tilde{j}_{-,m} \qquad &   
\partial_t \tilde{B}_{-,m} = \frac{ik}{2} \tilde{E}_{z,m} + k_z \tilde{E}_{-,m} \\
\partial_t \tilde{E}_{z,m} = ik ( \tilde{B}_{+,m} + \tilde{B}_{-,m} ) - \mu_0 \tilde{j}_{z,m}  \qquad & 
\partial_t \tilde{B}_{z,m} = -ik ( \tilde{E}_{+,m} + \tilde{E}_{-,m} )
\end{align}
(See \cref{sec:} for a derivation of these equations.)
 

Typically one needs only a few modes in $m$, therefore the fields are reduced to
a few 2D tables $\tilde{F}_m(k_z,k)$ instead of the 3D tables
$\hat{F}(k_x,k_y,k_z)$. (For instance, in a purely symmetric case, there is only one
mode: $m=0$.)




\section{Numerical implementation}

Grand scheme :
Explain intermediate grid
3 grids, interpolation, deposition 
Explain shape of the particle

\subsection{Field integration}

Could be integrated by finite difference, but we choose PSATD (for numerical dispersion).

\subsection{Current deposition}

\subsection{} 

\newpage
\appendix

\input{appendix.tex}

\end{document}  
