
\section{Derivation of the spectral quasi-cylindrical representation}
\label{sec:CircTrans}

In order to derive the representation
\cref{eq:CircBwTransz,eq:CircBwTransr,eq:CircBwTranst} we have to
distinguish the Cartesian components (e.g. $E_x$, $E_y$, $E_z$, $B_x$,
$B_y$, $B_z$) which are well-defined everywhere in space and thus have a regular
Fourier representation, from the cylindrical components (e.g. $E_r$,
$E_\theta$, $B_r$, $B_\theta$) which are ill-defined at $r=0$. (For instance, for a
field of the form $\vec{E} = E_0 \vec{e}_x$, the expression of $E_r$
is $E_r = E_0 \cos(\theta)$, which ill-defined at $r=0$, as $\theta$
itself is ill-defined at this position.)

\subsection{Cartesian components}

Let $F_u$ be the Cartesian component of a field $F$ 
(typically $F$ is $E$, $B$ or $J$ and $u$ is $x$, $y$ or $z$). Its Fourier representation
is thus given by \cref{eq:CartBwTrans,eq:CartFwTrans}:
\begin{align*}
F_u(\vec{r}) = \frac{1}{(2\pi)^{3}}\Integ{k_x} \,\Integ{k_y}\,
\Integ{k_z} \; \mathcal{F}_u(\vec{k}) e^{i(k_x x + k_y y + k_z z)} \\
\mathcal{F}_u(\vec{k})  = \Integ{x} \,\Integ{y}\,
\Integ{z} \; F_u(\vec{r}) e^{-i(k_x x + k_y y + k_z z)} 
\end{align*}
Using the change of variable $k_x=k_\perp\cos(\phi)$, $k_y = k_\perp\sin(\phi)$,
$x=r\cos(\theta)$, $y=r\sin(\theta)$, this becomes
 \begin{align*}
F_u(\vec{r}) = \frac{1}{(2\pi)^{3}}\Integ{k_z} \,\RInteg{k_\perp}\,
\TInteg{\phi} \; \mathcal{F}_u(\vec{k})
e^{i(k_\perp r \cos(\theta-\phi) + k_z z)} \\
\mathcal{F}_u(\vec{k})   = \Integ{z} \,\RInteg{r}\,
\Integ{\theta} \; F_u(\vec{r}) e^{-i(k_\perp r \cos(\theta-\phi) + k_z z)} 
\end{align*}
Let us now use the relation $e^{ik_\perp r\cos(\theta-\phi)} =
\sum_{m=-\infty}^{\infty} i^m J_m(k_\perp r) e^{im(\phi-\theta)}$
(which is simply another way of writing the well-known relation
$e^{i \alpha \sin \psi} =\sum_{m=-\infty}^{\infty}J_m(\alpha)e^{im\psi}$). The above equations become:
\begin{align*}
F_u (\vec{r})  = \sum_{m=-\infty}^{\infty} \frac{1}{(2\pi)^{3}}\Integ{k_z} \,\RInteg{k_\perp }
\TInteg{\phi} \; i^m \mathcal{F}_u(\vec{k}) \;
J_m(k_\perp r) e^{-im(\theta-\phi) + ik_z z} \\
\mathcal{F}_u(\vec{k})   =  \sum_{m=-\infty}^{\infty} \Integ{z} \,\RInteg{r}
\TInteg{\theta} \;\; (-i)^m F_u(\vec{r}) \; J_m(k_\perp r) e^{-im(\phi-\theta) -ik_z z} 
\end{align*}
We now define $\spectral{F}_{u,m}(k_z,k_\perp ) = \frac{1}{2\pi}\int_0^{2\pi}
\mathrm{d}\phi \; i^m \mathcal{F}_u(\vec{k})
e^{im\phi}$. This results in the following equations :
\begin{align}
F_u(\vec{r}) =  \frac{1}{(2\pi)^2}\sum_{m=-\infty}^{\infty} \Integ{k_z}
\RInteg{k_\perp }\; \spectral{F}_{u,m}(k_z,k_\perp ) \; J_m(k_\perp r) e^{-im\theta + ik_z z} 
\\
\spectral{F}_{u,m}(k_z,k_\perp ) = \Integ{z} \RInteg{r}
\TInteg{\theta} \;F_u(\vec{r})\; J_m(k_\perp r) e^{-im\theta
 - i k_z z} \label{eq:CircBwTransu}
\end{align}
These equations correspond to \cref{eq:CircBwTransz,eq:CircFwTransz}.

\subsection{Cylindrical components}

Let us now consider fields of the type $E_r$, $B_r$ or $J_r$, which we
denote generally by $F_r$. We have :
\[ F_r = \cos(\theta) F_x + \sin(\theta) F_y 
= \frac{F_x - iF_y}{2}e^{i\theta} + \frac{F_x +
  iF_y}{2}e^{-i\theta} \] 
Using \cref{eq:CircBwTransu}, this leads to
\begin{align*} 
F_r =   \frac{1}{(2\pi)^2}\sum_{m=-\infty}^{\infty} \Integ{k_z}\,\RInteg{k_\perp }\;
\left(  J_m(k_\perp r) \frac{\spectral{F}_{x,m} -
    i\spectral{F}_{y,m}}{2}e^{-i(m-1)\theta +ik_z z} + J_m(k_\perp r) \frac{\spectral{F}_{x,m} +   i\spectral{F}_{y,m}}{2}e^{-i(m+1)\theta +
    ik_z z} \right) 
\end{align*}
\begin{align*}
F_r =  \frac{1}{(2\pi)^2}\sum_{m=-\infty}^{\infty} \Integ{k_z}\,\RInteg{k_\perp }\;
\left(  J_{m+1}(k_\perp r) \frac{\spectral{F}_{x,m+1} -
    i\spectral{F}_{y,m+1}}{2}e^{-im\theta +ik_z z} + J_{m-1}(k_\perp r) \frac{\spectral{F}_{x,m-1} +   i\spectral{F}_{y,m-1}}{2}e^{-im\theta +
    ik_z z} \right) 
\end{align*}
where we relabeled the dummy variable $m$ in the above sums. Let us
thus define $\spectral{F}_{-,m} = (\spectral{F}_{x,m-1} +
    i\spectral{F}_{y,m-1})/2$ and $\spectral{F}_{+,m} = (\spectral{F}_{x,m+1} -
    i\spectral{F}_{y,m+1})/2$. This results in:
\begin{equation} 
F_r(\vec{r}) =  \frac{1}{(2\pi)^2}\sum_{m=-\infty}^{\infty} \Integ{k_z}\,\RInteg{k_\perp }\;
\left( \spectral{F}_{+,m}\; J_{m+1}(k_\perp r) +\spectral{F}_{-,m}\; J_{m-1}(k_\perp r)
\right)  e^{-im\theta +ik_z z}
\end{equation}

With the same definitions and the same method, it is also easy to show that:
\begin{equation} 
F_\theta(\vec{r}) = \sum_{m=-\infty}^{\infty} \Integ{k_z}\,\RInteg{k_\perp }\;
i\left( \spectral{F}_{+,m}\; J_{m+1}(k_\perp r) - \spectral{F}_{-,m}\; J_{m-1}(k_\perp r)
\right)  e^{-im\theta +ik_z z}
\end{equation}

\section{Maxwell equations for the spectral coefficients}
\label{sec:SpectMaxwell}

In this section, let us derive the Maxwell equations for the spectral
coefficients \cref{eq:CircMaxwellp,eq:CircMaxwellm,eq:CircMaxwellz}
from the Maxwell equations written in cylindrical coordinates \cref{eq:CircMaxwellr,eq:CircMaxwellt,eq:CircMaxwellzz}.

When replacing the Fourier-Hankel decomposition
(\cref{eq:CircBwTransu,eq:CircBwTransr,eq:CircBwTranst}) in the
Maxwell equations \cref{eq:CircMaxwellr,eq:CircMaxwellt,eq:CircMaxwellzz}, we
first notice that the modes proportional to $e^{-im\theta +ik_z z}$ for different
values of $m$ and $k_z$ are not coupled. These different modes can
thus be treated separately. The same cannot be said of the modes
corresponding to different values of $k_\perp $, since they may be coupled
through the Bessel functions $J_m(k_\perp r)$ and their derivatives. 
In the following, we write only the equations corresponding to $\partial_t \vec{B} =
-\vec{\nabla}\times \vec{E}$, since the equation $c^{-2}\partial_t \vec{E} =
\vec{\nabla}\times\vec{B} - \mu_0 \vec{j}$ can be treated very
similarly. These equations become
\begin{align*}
\RInteg{k_\perp } \left[ \; \partial_t \spectral{B}_{+,m}  J_{m+1}(k_\perp r)
  + \partial_t \spectral{B}_{-,m}  J_{m-1}(k_\perp r) \; \right] =&& \\ 
\qquad \RInteg{k_\perp } \left[ \; \spectral{E}_{z,m} \frac{im}{r}
  J_m(k_\perp r) \right.-&\left.
  k_z\spectral{E}_{+,m}J_{m+1}(k_\perp r) + k_z\spectral{E}_{-,m}J_{m-1}(k_\perp r) \;
\right] & \\
\RInteg{k_\perp } \left[ \; \partial_t \spectral{B}_{+,m}  J_{m+1}(k_\perp r)
  - \partial_t \spectral{B}_{-,m}  J_{m-1}(k_\perp r) \; \right] =&& \\
 \RInteg{k_\perp } \left[ \; -k_z\spectral{E}_{+,m}J_{m+1}(k_\perp r)
 \right.-&\left.  k_z\spectral{E}_{-,m}J_{m-1}(k_\perp r) - ik_\perp \spectral{E}_{z,m} J_m'(k_\perp r) \;\right] \\
\RInteg{k_\perp }\; \partial_t \spectral{B}_{z,m}  J_{m}(k_\perp r) =
\RInteg{k_\perp } \left[ \; -ik_\perp
  \spectral{E}_{+,m}\right.&\left(\frac{J_{m+1}(k_\perp r)}{k_\perp r} +
    J_{m+1}'(k_\perp r) \right) + &\\
\left. ik_\perp \spectral{E}_{-,m}\left(\frac{J_{m-1}(k_\perp r)}{k_\perp r} +
    J_{m-1}'(k_\perp r) \right) \right.-&\left. \frac{im}{r} \left( E_{+,m} J_{m+1}(k_\perp r) +
    E_{-,m} J_{m-1}(k_\perp r) \right) \;\right] 
\end{align*}
By taking the sum and difference of the first two equations, and by
rearranging the third equation, we obtain:
\begin{align*}
\RInteg{k_\perp } \; 2 \,\partial_t \spectral{B}_{+,m}  J_{m+1}(k_\perp r) =
\RInteg{k_\perp } \left[ \; ik_\perp \spectral{E}_{z,m} \left( \frac{m}{k_\perp r} J_m(k_\perp r) -
    J_m'(k_\perp r) \right) -2 k_z\spectral{E}_{+,m}J_{m+1}(k_\perp r) \;
\right] \\
\RInteg{k_\perp } \; 2\, \partial_t \spectral{B}_{-,m}  J_{m-1}(k_\perp r) \; =
\RInteg{k_\perp } \left[ \;
   ik_\perp \spectral{E}_{z,m} \left( \frac{m}{k_\perp r} J_m(k_\perp r) +
    J_m'(k_\perp r) \right)  + 2k_z\spectral{E}_{-,m}J_{m-1}(k_\perp r) \;
\right] \\
\RInteg{k_\perp }\; \partial_t \spectral{B}_{z,m}  J_{m}(k_\perp r) =
\RInteg{k_\perp } \left[ \; -ik_\perp \spectral{E}_{+,m}\left(\frac{m+1}{k_\perp r}J_{m+1}(k_\perp r) +
    J_{m+1}'(k_\perp r) \right) \right.\\
\qquad \left. - ik_\perp \spectral{E}_{-,m}\left(\frac{m-1}{k_\perp r}J_{m-1}(k_\perp r) -
    J_{m-1}'(k_\perp r) \right) \right] 
\end{align*}
We can now use the relations $\frac{m}{k_\perp r} J_m(k_\perp r) +
    J_m'(k_\perp r) = J_{m-1}(k_\perp r)$ and $\frac{m}{k_\perp r} J_m(k_\perp r) -
    J_m'(k_\perp r) = J_{m+1}(k_\perp r)$ (see relation 9.1.27 in
    \cite{Abramowitz}), and obtain :
\begin{align*}
\RInteg{k_\perp } \; 2 \,\partial_t \spectral{B}_{+,m}  J_{m+1}(k_\perp r) =
\RInteg{k_\perp } \left[ \; ik_\perp \spectral{E}_{z,m}\,
    J_{m+1}(k_\perp r) -2 k_z\spectral{E}_{+,m}J_{m+1}(k_\perp r) \;
\right] \\
\RInteg{k_\perp } \; 2\, \partial_t \spectral{B}_{-,m}  J_{m-1}(k_\perp r) \; =
\RInteg{k_\perp } \left[ \;
   ik_\perp \spectral{E}_{z,m} \,
    J_{m-1}(k_\perp r) + 2k_z\spectral{E}_{-,m}J_{m-1}(k_\perp r) \;
\right] \\
\RInteg{k_\perp }\; \partial_t \spectral{B}_{z,m}  J_{m}(k_\perp r) =
\RInteg{k_\perp } \left[ \; -ik_\perp \spectral{E}_{+,m} J_{m}(k_\perp r) - ik_\perp \spectral{E}_{-,m}\,J_{m}(k_\perp r) \right] 
\end{align*}
Each equation of the above system contains Bessel functions of only one
given order (either $m+1$, $m-1$ or $m$). This allows to separate the
different $k_\perp $ components, since the functions $J_n(k_\perp r)$, for a
fixed $n$ and different values of $k_\perp $, form a basis of the set of real functions:
\begin{align*}
2 \,\partial_t \spectral{B}_{+,m} =
ik_\perp \spectral{E}_{z,m} -2 k_z\spectral{E}_{+,m} \\
2\, \partial_t \spectral{B}_{-,m} = ik_\perp \spectral{E}_{z,m} \,
    + 2k_z\spectral{E}_{-,m} \\
 \partial_t \spectral{B}_{z,m} = -ik_\perp \spectral{E}_{+,m}  - ik_\perp \spectral{E}_{-,m}
\end{align*}

\section{PSATD scheme, in the Fourier-Bessel
  representation}
\label{sec:PSTADderiv}

We use a scheme very similar to that of \cite{Haber}. In this scheme the currents are considered constant over one timestep, and the charge density is considered linear in time.

\subsection{Expressions for $\spectral{B}_m$}

By combining \cref{eq:CircMaxwellp,eq:CircMaxwellm,eq:CircMaxwellz}
and \cref{eq:SpectCons}, one can find the propagation equations for $B$.
\begin{align*}
\partial_t^2 \spectral{B}_{+,m} + c^2(k_\perp ^2+k_z^2) \spectral{B}_{+,m} = 
\mu_0 c^2 \left( - \frac{ik_\perp }{2} \spectral{J}_{z,m} + k_z \spectral{J}_{+,m}
\right) \\
\partial_t^2 \spectral{B}_{-,m} + c^2(k_\perp ^2+k_z^2) \spectral{B}_{-,m} = 
\mu_0 c^2 \left( - \frac{ik_\perp }{2} \spectral{J}_{z,m} - k_z \spectral{J}_{-,m}
\right) \\
\partial_t^2 \spectral{B}_{z,m} + c^2(k_\perp ^2+k_z^2) \spectral{B}_{z,m} =
\mu_0c^2  (ik_\perp  \spectral{J}_{+,m} + ik_\perp \spectral{J}_{-,m} ) 
\end{align*}
Let us integrate these equations for $t\in [n\Delta t, (n+1)\Delta
t]$. In this interval, $\vec{\spectral{J}}_m(t)$ is constant
and equal to $\vec{\spectral{J}}_m^{n+1/2}$, and thus the right-hand side of the above
equations is constant. Using Green functions, the
general solution of a differential equation of the form 
$\partial_t^2 f + \omega^2 f = g_0$, where $g_0$ is a constant, is 
\[ f(t) = f(t_0) \cos[\,\omega (t-t_0)\,] + \partial_t f (t_0) \frac{
  \sin[\,\omega (t-t_0)\,]  }{\omega} + \frac{g_0}{\omega^2} (1-
\cos[\,\omega (t-t_0)\,] ) \]  
We thus use the above expression, with $\omega^2 =c^2(k_\perp^2 +
k_z^2)$, to integrate the fields from $t_0 = n\Delta t$ to $t=(n+1)\Delta t$. In
particular, we use again the Maxwell equations
\cref{eq:CircMaxwellp,eq:CircMaxwellm,eq:CircMaxwellz} to obtain the
expression of $\partial_t \spectral{B}_{m} (t_0)$. This yields:
\begin{align*}
\tB{+}{n+1} = \; & C \tB{+}{n} - 
\frac{S}{\omega}\left(-\frac{ik_\perp }{2} \tE{z}{n} + k_z\tE{+}{n}
\right) + \mu_0 c^2\frac{1-C}{\omega^2} \left( -\frac{ik_\perp }{2}
  \tj{z}{n+1/2} + k_z \tj{+}{n+1/2} \right)& \\
\tB{-}{n+1} =\; & C \tB{-}{n} - 
\frac{S}{\omega}\left(- \frac{ik_\perp }{2} \tE{z}{n} - k_z\tE{-}{n}
\right) + \mu_0 c^2\frac{1-C}{\omega^2} \left( - \frac{ik_\perp }{2}
  \tj{z}{n+1/2} - k_z \tj{-}{n+1/2} \right) &\\
\tB{z}{n+1} =\; & C \tB{z}{n} - 
\frac{S}{\omega}\left(ik_\perp \tE{+}{n} + ik_\perp \tE{-}{n}
\right) + \mu_0 c^2\frac{1-C}{\omega^2} \left( ik_\perp
  \tj{+}{n+1/2} + ik_\perp \tj{-}{n+1/2} \right)&
\end{align*}
where $C = \cos(\omega \Delta t)$ and $S = \sin(\omega \Delta t) $.

\subsection{Expressions for $\spectral{E}_m$}

Similarly, when combining \cref{eq:CircMaxwellp,eq:CircMaxwellm,eq:CircMaxwellz}
and \cref{eq:SpectCons}, the propagation equations for $E$ are:
\begin{align*}
\partial_t^2 \spectral{E}_{+,m} + c^2(k_\perp^2 + k_z^2) \spectral{E}_{+,m}
= \frac{c^2}{\epsilon_0} \frac{k_\perp}{2} \spectral{\rho}_m -
\mu_0c^2 \partial_t\spectral{J}_{+,m} \\
\partial_t^2 \spectral{E}_{-,m} + c^2(k_\perp^2 + k_z^2) \spectral{E}_{-,m}
= - \frac{c^2}{\epsilon_0} \frac{k_\perp}{2} \spectral{\rho}_m -
\mu_0c^2 \partial_t\spectral{J}_{-,m} \\
\partial_t^2 \spectral{E}_{z,m} + c^2(k_\perp^2 + k_z^2) \spectral{E}_{z,m}
= - \frac{c^2}{\epsilon_0} i k_z \spectral{\rho}_m -
\mu_0c^2 \partial_t\spectral{J}_{z,m} 
\end{align*}
Let us again integrate these equations for $t\in [n\Delta t, (n+1)\Delta
t]$. In this interval, $\vec{\spectral{J}}_m(t)$ is constant (thus its time
derivatives drop), and $\spectral{\rho}_m$ is linear in time. As a
consequence the right hand side is proportional to $\trho{n} +
(\trho{n+1}-\trho{n})(t-t_0)/\Delta t$. Using Green functions, the solution of 
$ \partial_t^2 f + \omega^2 f = \trho{n} + (\trho{n+1}-\trho{n})(t-t_0)/\Delta t $ is
\[ f(t) = f(t_0) \cos[\,\omega(t-t_0)\,] + \partial_tf (t_0)
\frac{\sin[\,\omega(t-t_0)\,]}{\omega} + \trho{n}\frac{1-
  \cos[\,\omega(t-t_0)\,]}{\omega^2} + \frac{\trho{n+1}-\trho{n}}{\omega^2}\left(
  \frac{t-t_0}{\Delta t} - \frac{\sin[\,\omega(t-t_0)\,]}{\omega
    \Delta t}
\right) \]
which, for $t=t_0 +\Delta t$, reduces to
\[ f(t_0 +\Delta t) = f(t_0) C + \partial_tf (t_0)
\frac{S}{\omega} 
+ \frac{\trho{n+1}}{\omega^2}\left( 1 - \frac{S}{\omega\Delta t}\right) 
- \frac{\trho{n}}{\omega^2}\left( C - \frac{S}{\omega\Delta t}\right) \]
Using the above expression, we obtain
\begin{align*}
\tE{+}{n+1} = \; & C \tE{+}{n} + 
c^2\frac{S}{\omega}\left(-\frac{ik_\perp }{2} \tB{z}{n} + k_z\tB{+}{n}
- \mu_0 \tj{+}{n+1/2} \right) + \frac{c^2}{\epsilon_0}
\frac{k_\perp}{2}\left[ \frac{\trho{n+1}}{\omega^2}\left(
  1 - \frac{S}{\omega\Delta t}\right) -
\frac{\trho{n}}{\omega^2}\left( C -\frac{S}{\omega\Delta t}\right)\right]  & \\
\tE{-}{n+1} =\; & C \tE{-}{n} +
c^2\frac{S}{\omega}\left(- \frac{ik_\perp }{2} \tB{z}{n} - k_z\tB{-}{n}
- \mu_0 \tj{-}{n+1/2} \right) - \frac{c^2}{\epsilon_0}
\frac{k_\perp}{2}\left[ \frac{\trho{n+1}}{\omega^2}\left(
  1 - \frac{S}{\omega\Delta t}\right) - \frac{\trho{n}}{\omega^2}
\left( C - \frac{S}{\omega\Delta t}\right)\right]  &\\
\tE{z}{n+1} =\; & C \tE{z}{n} + 
c^2\frac{S}{\omega}\left(ik_\perp \tB{+}{n} + ik_\perp \tB{-}{n}
- \mu_0 \tj{z}{n+1/2} \right) - \frac{c^2}{\epsilon_0}
ik_z\left[ \frac{\trho{n+1}}{\omega^2}\left(
  1 - \frac{S}{\omega\Delta t}\right) - \frac{\trho{n}}{\omega^2}
\left( C - \frac{S}{\omega\Delta t}\right)\right]  &
\end{align*}

\section{Discrete Hankel Transform}
\label{sec:HTMatrix}

Here we use a transformation similar to that of \cite{Yu,Guizar,KaiMing}, but
extend it to the case of an evenly-spaced grid in real space (as opposed to one
that is distributed according to the zeros of the Bessel
function). Moreover, we impose, as much as possible, that the
succession of a Discrete Hankel Transform (DHT) and an Inverse Discrete
Hankel Transform (IDHT) retrieve the initial function.

As explained in the text of the article, we use a matrix formalism for
the discrete Hankel transform
\[ \mathrm{DHT^m_n}[f] \,(k^m_{\perp,j}) = \sum_{p=0}^{N_r-1} (M_{n,m})_{j,p}
\,f(r_p) \qquad \mathrm{IDHT^m_n}[g] \, (r_j) = \sum_{p=0}^{N_r-1}
(M'_{n,m})_{j,p} \,g(k^m_{\perp,p}) \]
\noindent where $n$ is the order of the Hankel transform, and where
$m$ is the index of the spectral grid
$k^m_{\perp,j}$ on which the Hankel transform is evaluated. 
In practice, as mentioned in the text, these
transforms are only used in the cases $n=m-1$, $n=m$ or $n=m+1$.

The matrices $M_{n,m}$ and $M'_{n,m}$ can be determined by a set of $N_r^2$ conditions. These
conditions can be found, for instance, by imposing the value of the
DHT for a set of $N_r$ different functions, whose exact analytical Hankel
transforms are known. In our case, we impose that the DHT be equal to the exact analytical
Hankel transform for the eigenmodes of a cavity with
perfectly conducting boundary at $r_{max}$ ($E_z(r_{max},z) =
0$), since these physical eigenmodes should also be eigenmodes of our
PIC cycle. These eigenmodes have the following form:
\begin{align*}
E_z \;& \; \propto  J_m(k^m_{\perp,\ell} \,r)\,e^{ik_z z -im\theta} \Theta(r_{max}-r) \\
E_r -i E_\theta \;& \; \propto  J_{m+1}(k^m_{\perp,\ell} \,r) \,e^{ik_z z -im\theta} \Theta(r_{max}-r)\\
E_r +i E_\theta \;& \; \propto  J_{m-1}(k^m_{\perp,\ell} \,r)
                    \,e^{ik_z z -im\theta} \Theta(r_{max}-r) 
\end{align*}
where $\Theta$ is the Heaviside function and where $k^m_{\perp,\ell} =
\alpha^m_\ell / r_{max}$, with $\alpha^m_\ell$ the $\ell$th positive zero of
the Bessel function of order $m$. These eigenmodes form an othogonal basis of
functions for the chosen boundary condition. The exact Hankel
transform of these modes, evaluated on the discrete set
$\{k^m_{\perp,j} \}$ reads (see relation 11.4.5 in \cite{Abramowitz}).
\[ \mathrm{HT}_{n}[ \; J_n(k^m_{\perp,\ell} \,r)  \Theta(r_{max}-r)  \;] \,(k^m_{\perp,j} )
\quad \equiv 2\pi \rInteg \; J_n (k^m_{\perp,\ell} r) J_n (k^m_{\perp,j} r)
\quad = \pi\, r_{max}^2\,[ J_{m-1}(\alpha_\ell^m)]^2 \; \delta_{j,\ell} \]
where $n$ is either $m-1$, $m$ or $m+1$. (Notice that the final
result actually does not depend on $n$.) Here we impose that the DHT of these functions has the same value for $(j,\ell) \in \{ 0,..., N_r - 1\}$.
\begin{equation}
\label{eq:DHT-matrix}
\mathrm{DHT}^m_{n}[ \; J_n(k^m_{\perp,\ell} \,r) \Theta(r_{max}-r)  \;] \,(k^m_{\perp,j}) 
\quad \equiv \sum_{p=0}^{N_r-1} (M_{n,m})_{j,p}
  J_n(k^m_{\perp,\ell}\,r_p) 
\quad = \pi\, r_{max}^2\,[ J_{m-1}(\alpha_j^m)]^2 \; \delta_{j,\ell} 
\end{equation}

\paragraph{Case in which $n=0$ or $m=0$:}
In this case, \cref{eq:DHT-matrix} imposes $N_r^2$ conditions on the matrix
$M_{n,m}$ and thus allows one to completely determine it. 
In fact, a closer look at the above relations shows
that the inverse matrix $M^{-1}_{n,m}$ can be directly extracted from the above relations,
since these inverse matrices are defined by the relation $\sum_p (M_{n,m})_{j,p}
(M^{-1}_{n,m})_{p,\ell} = \delta_{j,\ell}$. Indeed, from the above
relations, one can directly infer:
\[ (M_{n,m}^{-1})_{p,\ell} = \frac{ J_n(k^m_{\perp,\ell}\,r_p) } { \pi\,
  r_{max}^2\,[ J_{m-1}(\alpha_\ell^m)]^2  } \]

\noindent The matrix $M_{n,m}$ can then be extracted, by numerically inverting
the matrices  $M^{-1}_{n,m}$ given by the above expression. In
addition, we impose that $M'_{n,m}$ be equal to
$M^{-1}_{n,m}$, so that the succession of a DHT and IDHT retrieves
exactly the initial function.


\comment{This last paragraph is still to be modified}
\paragraph{Case in which $n \neq 0$ and $m \neq 0$} In this case, the
equation \cref{eq:DHT-matrix} is not valid for $\ell=0$, and should be
replaced by
\[ \mathrm{DHT}^m_{n}[ \; J_n(k^m_{\perp,0} \,r) \Theta(r_{max}-r)  \;] \,(k^m_{\perp,j}) 
\quad \equiv \sum_{p=0}^{N_r-1} (M_{n,m})_{j,p}
  J_n(k^m_{\perp,0}\,r_p) \quad = 0 \]
\noindent This implies that $M_{n,m}$ is not invertible, and that the
method used in the case $n=0$ or $m=0$ is not applicable. To obtain
$M_{n,m}$ in this case, we use an empirical method in which replace
the above relation by 
\[\sum_{p=0}^{N_r-1} (M_{n,m})_{0,p}J_n(k^m_{\perp,\ell}\,r_p) = \pi\,
r_{max}^2\,[ J_{m-1}(\alpha_{N_r}^m)]^2 \; \delta_{0,N_r} \]
does not constraint the matrix $M_{n,m}$
sufficiently, and thus we impose the additional condition 

We note works for $m=0$ and $m=1$ but not $m=2$. Futher work will be
done towards better Hankel transform representation.

%(In the case $m>0,n>0$, the above expression is modified for $\ell=0$ and
%is replaced by $ (M_{n,m}^{-1})_{p,0} = \frac{ J_m(k^m_{\perp,N_r}\,r_p) } { \pi\,
 % r_{max}^2\,[ J_{m-1}(\alpha_{N_r}^m)]^2  }$.)